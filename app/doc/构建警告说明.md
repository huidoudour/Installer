# âš ï¸ æ„å»ºè­¦å‘Šè¯´æ˜ä¸è§£å†³æ–¹æ¡ˆ

## ğŸ” å¯èƒ½å‡ºç°çš„ 4 ä¸ªè­¦å‘Š

### è­¦å‘Š 1: NDK ç‰ˆæœ¬æœªæŒ‡å®š

**è­¦å‘Šä¿¡æ¯:**
```
This version of the NDK may be incompatible with the Gradle plugin you are using.
```

**åŸå› :**
- `build.gradle.kts` ä¸­æŒ‡å®šäº†å›ºå®šçš„ NDK ç‰ˆæœ¬,ä½†å¯èƒ½æœªå®‰è£…

**è§£å†³æ–¹æ¡ˆ:**
å·²ç§»é™¤å›ºå®š NDK ç‰ˆæœ¬è¦æ±‚,ä½¿ç”¨ Android Studio è‡ªåŠ¨ç®¡ç†çš„ NDK

**çŠ¶æ€:** âœ… å·²ä¿®å¤


### è­¦å‘Š 2: CMake ç‰ˆæœ¬è­¦å‘Š

**è­¦å‘Šä¿¡æ¯:**
```
CMake Warning: Manually-specified variables were not used by the project:
  CMAKE_VERBOSE_MAKEFILE
```

**åŸå› :**
- æŸäº› CMake å˜é‡åœ¨æ„å»ºä¸­æœªè¢«ä½¿ç”¨

**å½±å“:**
- æ— å½±å“,ä»…æ˜¯ä¿¡æ¯æ€§è­¦å‘Š
- ä¸ä¼šå½±å“ç¼–è¯‘ç»“æœ

**è§£å†³æ–¹æ¡ˆ:**
è¿™æ˜¯æ­£å¸¸çš„,å¯ä»¥å¿½ç•¥ã€‚å¦‚æœè¦æ¶ˆé™¤æ­¤è­¦å‘Š:

```kotlin
// åœ¨ build.gradle.kts ä¸­ç§»é™¤
arguments += listOf(
    "-DANDROID_STL=c++_shared"
    // "-DCMAKE_VERBOSE_MAKEFILE=ON"  // æ³¨é‡Šæ‰è¿™è¡Œ
)
```

**çŠ¶æ€:** âš ï¸ å¯å¿½ç•¥


### è­¦å‘Š 3: ABI è¿‡æ»¤å™¨é‡å¤

**è­¦å‘Šä¿¡æ¯:**
```
Using both android.defaultConfig.ndk.abiFilters and android.splits.abi may result in unexpected behavior
```

**åŸå› :**
- åŒæ—¶åœ¨ `defaultConfig` å’Œ `splits.abi` ä¸­æŒ‡å®šäº†æ¶æ„

**å½±å“:**
- å¯èƒ½å¯¼è‡´ç”Ÿæˆçš„ APK æ¶æ„ä¸ç¬¦åˆé¢„æœŸ

**è§£å†³æ–¹æ¡ˆ:**
å½“å‰é…ç½®æ­£ç¡®,ä¸¤å¤„é…ç½®ä¸€è‡´:
```kotlin
// defaultConfig ä¸­
abiFilters("arm64-v8a", "x86_64")

// splits.abi ä¸­
include("arm64-v8a", "x86_64")
```

**çŠ¶æ€:** âœ… å·²ä¼˜åŒ–


### è­¦å‘Š 4: C++ æ ‡å‡†åº“é€‰æ‹©

**è­¦å‘Šä¿¡æ¯:**
```
Building with libc++ is the recommended option. Consider removing 'ANDROID_STL' argument.
```

**åŸå› :**
- æ˜¾å¼æŒ‡å®šäº† `c++_shared`,ä½†è¿™å·²ç»æ˜¯é»˜è®¤é€‰é¡¹

**å½±å“:**
- æ— å®é™…å½±å“

**è§£å†³æ–¹æ¡ˆ:**
ä¿æŒå½“å‰é…ç½®,æ˜¾å¼æŒ‡å®šæ›´æ¸…æ™°:
```kotlin
arguments += listOf(
    "-DANDROID_STL=c++_shared"  // æ˜ç¡®ä½¿ç”¨å…±äº« C++ åº“
)
```

**çŠ¶æ€:** âœ… ä¿æŒå½“å‰é…ç½®


## ğŸ› ï¸ å¦‚ä½•æŸ¥çœ‹æ„å»ºè­¦å‘Š

### æ–¹æ³• 1: Gradle Console (Android Studio)

1. æ‰“å¼€ Android Studio
2. ç‚¹å‡»åº•éƒ¨çš„ "Build" æ ‡ç­¾
3. é€‰æ‹© "Gradle Console"
4. æŸ¥çœ‹æ„å»ºè¾“å‡ºä¸­çš„ WARNING æ ‡è®°

### æ–¹æ³• 2: å‘½ä»¤è¡Œ

```powershell
# æ„å»ºå¹¶æŸ¥çœ‹è¯¦ç»†è¾“å‡º
.\gradlew assembleDebug --warning-mode all
```

### æ–¹æ³• 3: Build Analyzer

1. æ„å»ºå®Œæˆå
2. ç‚¹å‡» "Build" â†’ "Analyze Build"
3. æŸ¥çœ‹ "Warnings" éƒ¨åˆ†


## âœ… æœ€ä½³å®è·µé…ç½®

### å½“å‰ build.gradle.kts é…ç½®(æ¨è)

```kotlin
android {
    defaultConfig {
        // NDK é…ç½®
        externalNativeBuild {
            cmake {
                // æŒ‡å®šæ”¯æŒçš„æ¶æ„
                abiFilters("arm64-v8a", "x86_64")
                // C++ ç¼–è¯‘å‚æ•°
                cppFlags += listOf("-std=c++17")
                // ä½¿ç”¨å…±äº« C++ åº“
                arguments += listOf("-DANDROID_STL=c++_shared")
            }
        }
    }
    
    // CMake è·¯å¾„é…ç½®
    externalNativeBuild {
        cmake {
            path = file("src/main/cpp/CMakeLists.txt")
            version = "3.22.1"
        }
    }
    
    // åˆ†æ¶æ„ APK
    splits {
        abi {
            isEnable = true
            reset()
            include("arm64-v8a", "x86_64")
            isUniversalApk = true
        }
    }
}
```


## ğŸ”§ æ¶ˆé™¤æ‰€æœ‰è­¦å‘Š(å¯é€‰)

å¦‚æœä½ æƒ³å®Œå…¨æ¶ˆé™¤è­¦å‘Š,å¯ä»¥è¿™æ ·é…ç½®:

```kotlin
android {
    defaultConfig {
        externalNativeBuild {
            cmake {
                abiFilters("arm64-v8a", "x86_64")
                cppFlags += listOf("-std=c++17")
                // ç§»é™¤ VERBOSE å‚æ•°
            }
        }
    }
    
    externalNativeBuild {
        cmake {
            path = file("src/main/cpp/CMakeLists.txt")
            version = "3.22.1"
        }
    }
    
    // åªä½¿ç”¨ splits,ä¸åœ¨ defaultConfig ä¸­æŒ‡å®š
    splits {
        abi {
            isEnable = true
            reset()
            include("arm64-v8a", "x86_64")
            isUniversalApk = true
        }
    }
}
```


## ğŸ¯ æ¨èé…ç½®

**å½“å‰é…ç½®å·²ç»æ˜¯æœ€ä½³å®è·µ,å»ºè®®ä¿æŒä¸å˜:**

âœ… **ä¼˜ç‚¹:**
1. æ˜ç¡®æŒ‡å®šæ¶æ„,é¿å…è¯¯è§£
2. æ˜¾å¼é…ç½® C++ æ ‡å‡†åº“,ä¾¿äºç»´æŠ¤
3. åŒæ—¶ç”Ÿæˆå•æ¶æ„å’Œé€šç”¨ APK

âš ï¸ **æ³¨æ„:**
- éƒ¨åˆ†è­¦å‘Šæ˜¯ä¿¡æ¯æ€§çš„,ä¸å½±å“åŠŸèƒ½
- è¿‡åº¦ä¼˜åŒ–å¯èƒ½å¯¼è‡´é…ç½®ä¸æ¸…æ™°


## ğŸ“Š è­¦å‘Šä¼˜å…ˆçº§

| è­¦å‘Š | ä¼˜å…ˆçº§ | æ˜¯å¦éœ€è¦ä¿®å¤ |
|------|--------|-------------|
| NDK ç‰ˆæœ¬ä¸å…¼å®¹ | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |
| ABI è¿‡æ»¤å™¨é‡å¤ | ğŸŸ¡ ä¸­ | âœ… å·²ä¼˜åŒ– |
| CMake å˜é‡æœªä½¿ç”¨ | ğŸŸ¢ ä½ | âš ï¸ å¯å¿½ç•¥ |
| C++ åº“é€‰æ‹©æç¤º | ğŸŸ¢ ä½ | âœ… ä¿æŒå½“å‰ |


## ğŸ” éªŒè¯é…ç½®

è¿è¡ŒéªŒè¯è„šæœ¬:

```powershell
.\verify-native-config.ps1
```

åº”è¯¥çœ‹åˆ°:
```
=== C++ åŸç”Ÿåº“é…ç½®éªŒè¯ ===

[1/7] æ£€æŸ¥ C++ æºæ–‡ä»¶... âœ…
[2/7] æ£€æŸ¥ CMakeLists.txt... âœ… (16KB å¯¹é½å·²é…ç½®)
[3/7] æ£€æŸ¥ NativeHelper.java... âœ…
[4/7] æ£€æŸ¥ build.gradle.kts NDK é…ç½®... âœ…
[5/7] æ£€æŸ¥æ¶æ„è¿‡æ»¤å™¨... âœ… (arm64-v8a, x86_64)
[6/7] æ£€æŸ¥ CMake è·¯å¾„é…ç½®... âœ…
[7/7] æ£€æŸ¥ Android NDK... âœ…

âœ… æ‰€æœ‰å¿…è¦é…ç½®å·²å®Œæˆ!
```


## ğŸš€ æ„å»ºæµ‹è¯•

### æ¸…ç†æ„å»º

```powershell
# æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰©
.\gradlew clean

# é‡æ–°æ„å»º
.\gradlew assembleDebug
```

### æ£€æŸ¥è¾“å‡º

```powershell
# æŸ¥çœ‹ç”Ÿæˆçš„ APK
ls app\build\outputs\apk\debug\

# åº”è¯¥çœ‹åˆ°:
# app-arm64-v8a-debug.apk
# app-x86_64-debug.apk
# app-universal-debug.apk
```


## ğŸ“š ç›¸å…³èµ„æº

- [Android NDK å®˜æ–¹æ–‡æ¡£](https://developer.android.com/ndk)
- [CMake è­¦å‘Šæ–‡æ¡£](https://cmake.org/cmake/help/latest/manual/cmake.1.html)
- [Gradle æ„å»ºä¼˜åŒ–](https://developer.android.com/studio/build/optimize-your-build)


## âœ… æ€»ç»“

### å½“å‰çŠ¶æ€:
- âœ… æ‰€æœ‰å…³é”®é…ç½®æ­£ç¡®
- âš ï¸ éƒ¨åˆ†ä¿¡æ¯æ€§è­¦å‘Šå¯å¿½ç•¥
- âœ… æ„å»ºå¯ä»¥æ­£å¸¸å®Œæˆ
- âœ… åŸç”Ÿåº“èƒ½æ­£ç¡®æ‰“åŒ…

### å»ºè®®:
1. **ä¿æŒå½“å‰é…ç½®** - å·²ç»æ˜¯æœ€ä½³å®è·µ
2. **å¿½ç•¥ CMake ä¿¡æ¯æ€§è­¦å‘Š** - ä¸å½±å“åŠŸèƒ½
3. **å®šæœŸæ›´æ–° NDK** - ä½¿ç”¨ Android Studio ç®¡ç†
4. **å…³æ³¨é”™è¯¯è€Œéè­¦å‘Š** - ä¼˜å…ˆè§£å†³å®é™…é—®é¢˜

---

**æœ€åæ›´æ–°:** 2025-12-04  
**é…ç½®çŠ¶æ€:** âœ… å·²ä¼˜åŒ–
